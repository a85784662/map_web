<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>print</title>
	<link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>
	<div style="width:794px;height:1123px; margin: 0 auto;">
		<div class="lmw-print-head">重庆恢恢信息技术有限公司智慧工地安装清单</div>
		<div class="lmw-table-wrap1 l-clear">
			<table class="lmw-table">
				<tr>
					<td class="lmw-table-title">工地名称：</td>
					<td>
						<select class="xzgongdi2">
							<option value="0">选择工地</option>
						</select>
					</td>
				</tr>
				<tr>
					<td class="lmw-table-title">客户名称：</td>
					<td class="j-khmc"></td>
				</tr>
				<tr>
					<td class="lmw-table-title">安装地址：</td>
					<td class="j-address"></td>
				</tr>
			</table>
		</div>
		<div class="lmw-table-content l-clear">
			<div class="lmw-t-cont-title fontbold">施工内容</div>
			<div class="lmw-table-wrap1 l-clear">
				<p class="lmw-t-cont-tit2 fontbold">一、考勤系统</p>
				<table class="lmw-table2">
					<thead>
						<tr>
							<td>设备名称</td>
							<td>设备编号</td>
							<td>设备数量</td>
							<td>安装位置</td>
							<td>备注</td>
						</tr>
					</thead>
					<tbody id="kaoqing-view">

					</tbody>
				</table>
				<p class="lmw-t-cont-tit2 fontbold">二、工地环境、设备监测系统</p>
				<table class="lmw-table2 ta-m j-show-huanjing">
					<thead>
						<tr>
						<tr>
							<td>设备名称</td>
							<td>设备编号</td>
							<td>设备数量</td>
							<td>安装位置</td>
							<td>备注</td>
						</tr>
						</tr>
					</thead>
					<tbody id="huanjing-view">

					</tbody>
				</table>
				<table class="lmw-table2 ta-m j-show-taji">
					<thead>
						<tr>
						<tr>
							<td>设备名称</td>
							<td>设备编号</td>
							<td>设备数量</td>
							<td>安装位置</td>
							<td>备注</td>
						</tr>
						</tr>
					</thead>
					<tbody id="taji-view">

					</tbody>
				</table>
				<table class="lmw-table2 ta-m j-show-shengjiangji">
					<thead>
						<tr>
						<tr>
							<td>设备名称</td>
							<td>设备编号</td>
							<td>设备数量</td>
							<td>安装位置</td>
							<td>备注</td>
						</tr>
						</tr>
					</thead>
					<tbody id="shengjiangji-view">

					</tbody>
				</table>

			</div>
		</div>
		<div class="lmw-table-footer l-clear" style="margin-top: 10px;">
			<table class="lmw-table">
				<tr>
					<td class="lmw-table-title">安装人员：</td>
					<td></td>
					<td class="lmw-table-title">日期：</td>
					<td></td>
				</tr>
				<tr>
					<td class="lmw-table-title">客户确认签字：</td>
					<td></td>
					<td class="lmw-table-title">日期：</td>
					<td></td>
				</tr>
			</table>
		</div>
		<div class="lmw-print-button-wrap">
			<button class="lmw-print-button">打 印</button>
		</div>
	</div>
	<div class="loading-wrap">
		<div class="loadEffect">
			<span></span>
			<span></span>
			<span></span>
			<span></span>
			<span></span>
			<span></span>
			<span></span>
			<span></span>
		</div>
	</div>
</body>
<script src="js/jquery.min.js"></script>
<script src="js/layui.all.js"></script>
<script id="demo-kaoqing" type="text/html">
	{{#  layui.each(d, function(index, item){ }}
	<tr>
		<td style="width:70px">考勤机</td>
		<td style="width:150px">{{item.equipment_deviceSerialNo}}</td>
		{{#  if(index === 0){ }}
		<td rowspan={{d.length}} style="width:70px">{{d.length}}</td>
		{{#  } }} 
		<td style="width:200px">{{item.equipment_position}}</td>
		<td></td>
	</tr>
	{{#  }); }}
</script>

<script id="demo-huanqing" type="text/html">
	{{#  layui.each(d, function(index, item){ }}
	<tr>
		<td style="width:70px">环境监测</td>
		<td style="width:150px">{{item.sourceId}}</td>
		{{#  if(index === 0){ }}
		<td rowspan={{d.length}} style="width:70px">{{d.length}}</td>
		{{#  } }} 
		<td style="width:200px">{{item.environmentInfoAddr}}</td>
		<td></td>
	</tr>
	{{#  }); }}
</script>

<script id="demo-taji" type="text/html">
	{{#  layui.each(d, function(index, item){ }}
	<tr>
		<td style="width:70px">塔机监测</td>
		<td style="width:150px">{{item.sourceId}}</td>
		{{#  if(index === 0){ }}
		<td rowspan={{d.length}} style="width:70px">{{d.length}}</td>
		{{#  } }} 
		<td style="width:200px">{{item.craneInfoAddr}}</td>
		<td></td>
	</tr>
	{{#  }); }}
</script>

<script id="demo-shengjiangji" type="text/html">
	{{#  layui.each(d, function(index, item){ }}
	<tr>
		<td style="width:70px">升降机监测</td>
		<td style="width:150px">{{item.sourceId}}</td>
		{{#  if(index === 0){ }}
		<td rowspan={{d.length}} style="width:70px">{{d.length}}</td>
		{{#  } }} 
		<td style="width:200px">{{item.elevatorInfoAddr}}</td>
		<td></td>
	</tr>
	{{#  }); }}
</script>

<script>
	$('.lmw-print-button').click(function () {
		window.print()
	});
	//工地选择初始化
	$.ajax({
		type: "get",
		url: "/findProjectList?start=1&display=10000",
		dataType: "json",
		success: function (response) {
			var data = response.content;
			var ele = "";
			for (var i = 0; i < data.length; i++) {
				ele += '<option project_code=' + data[i].project_code + ' address=' + data[i].address + ' work_unit=' + data[i].work_unit + ' value=' + data[i].id + '>' + data[i].name + '</option>'
			}
			$('.xzgongdi2').html("");
			$('.xzgongdi2').append('<option value="0">选择工地</option>')
			$('.xzgongdi2').append(ele)
		},
		complete:function(){
			$('.loading-wrap').hide();
		}
	});

	//工地选择change事件
	$('body').on('change', '.xzgongdi2', function () {
		$('.loading-wrap').show();
		var projectId = $(this).val();
		var address = $(this).find("option:selected").attr('address');
		var work_unit = $(this).find("option:selected").attr('work_unit');
		var project_code = $(this).find("option:selected").attr("project_code");

		$('.j-khmc').text(work_unit);
		$('.j-address').text(address);
		//考勤机打印
		$.ajax({
			type: "get",
			url: "/findProjectInfo?projectId=" + projectId,
			dataType: "json",
			success: function (response) {
				var data = response.content.attList
				var getTpl = document.getElementById('demo-kaoqing').innerHTML
					, view = document.getElementById('kaoqing-view');

				layui.use('laytpl', function () {
					var laytpl = layui.laytpl;
					laytpl(getTpl).render(data, function (html) {
						view.innerHTML = html;
					});

				});

			},
			complete:function(){
				$('.loading-wrap').hide();
			}
		});

		//获取设备信息统计
		$.ajax({
			type: "get",
			url: "/system/getEquipmentInfo?projectCode=" + project_code,
			dataType: "json",
			success: function (response) {
				var getTpl = document.getElementById('demo-taji').innerHTML
					, view = document.getElementById('gd-online-view');

				layui.use('laytpl', function () {
					var laytpl = layui.laytpl;
					laytpl(getTpl).render(response, function (html) {
						view.innerHTML = html;
					});

				});

			},
			complete:function(){
				$('.loading-wrap').hide();
			}
		});

		//环境监测
		$.ajax({
			type: "get",
			url: "/system/getEquipmentInfoNew?type=1&projectCode=" + project_code,
			dataType: "json",
			success: function (response) {
				if (response.length > 0) {
					$('.j-show-huanjing').show();
				} else {
					$('.j-show-huanjing').hide();
				};
				var getTpl = document.getElementById('demo-huanqing').innerHTML
					, view = document.getElementById('huanjing-view');
				layui.use('laytpl', function () {
					var laytpl = layui.laytpl;
					laytpl(getTpl).render(response, function (html) {
						view.innerHTML = html;
					});

				});

			},
			complete:function(){
				$('.loading-wrap').hide();
			}
		});
		/////////over

		//塔机监测
		$.ajax({
			type: "get",
			url: "/system/getEquipmentInfoNew?type=2&projectCode=" + project_code,
			dataType: "json",
			success: function (response) {

				if (response.length > 0) {
					$('.j-show-taji').show();
				} else {
					$('.j-show-taji').hide();
				}

				var getTpl = document.getElementById('demo-taji').innerHTML
					, view = document.getElementById('taji-view');
				layui.use('laytpl', function () {
					var laytpl = layui.laytpl;
					laytpl(getTpl).render(response, function (html) {
						view.innerHTML = html;
					});

				});


			},
			complete:function(){
				$('.loading-wrap').hide();
			}
		});
		/////////over

		//升降机监测
		$.ajax({
			type: "get",
			url: "/system/getEquipmentInfoNew?type=3&projectCode=" + project_code,
			dataType: "json",
			success: function (response) {
				if (response.length > 0) {
					$('.j-show-shengjiangji').show();
				} else {
					$('.j-show-shengjiangji').hide();
				}

				var getTpl = document.getElementById('demo-shengjiangji').innerHTML
					, view = document.getElementById('shengjiangji-view');
				layui.use('laytpl', function () {
					var laytpl = layui.laytpl;
					laytpl(getTpl).render(response, function (html) {
						view.innerHTML = html;
					});

				});
			},
			complete:function(){
				$('.loading-wrap').hide();
			}
		});
		/////////over


	})


</script>

</html>